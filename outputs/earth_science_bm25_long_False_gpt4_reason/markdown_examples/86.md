# Query `86`

## Original Question

*Atmospheric mixing ratios of the hydroxyl radical have relatively short lifespans (on the order of microseconds). When modeling air quality or the weather, the time step is usually much larger than the the half life of hydroxyl. How is this computation numerically stable? Is the problem of numerical stability simply ignored?*

## gpt4 Reasoning

```markdown
The essential problem here involves the challenge of accurately modeling and predicting air quality or weather conditions when dealing with chemical species, like the hydroxyl radical (OH), that have very short lifespans compared to the typical time steps used in these models. The hydroxyl radical is crucial for understanding atmospheric chemistry because it reacts with many pollutants and greenhouse gases, affecting both air quality and climate. However, its short lifespan raises questions about numerical stability in modeling efforts, given that conventional time steps in such models are significantly longer than the half-life of OH.

### Step 1: Understanding the Nature of the Problem

The issue of numerical stability in this context refers to the ability of a numerical method to produce accurate and consistent results over time, even when simulating processes that occur on much shorter time scales than the model's time step. If a model's time step is much longer than the half-life of a key reactive species like OH, there's a risk that the model could miss important dynamics or produce errors that accumulate over time, leading to inaccurate predictions.

### Step 2: Relevant Information and Strategies

1. **Chemical Kinetics in Atmospheric Models**: Understanding how atmospheric models incorporate chemical kinetics, particularly for species with short lifespans like OH, is crucial. These models often use complex chemical schemes that include hundreds of reactions and species, requiring careful numerical treatment to ensure stability and accuracy.

2. **Numerical Methods for Stiff Equations**: The equations governing atmospheric chemistry can be "stiff," meaning there's a wide disparity in the rates of reaction. Numerical methods designed for stiff equations, such as implicit solvers, are often used because they can handle the rapid changes in concentrations of species like OH without sacrificing stability.

3. **Sub-stepping or Operator Splitting**: One approach to deal with fast-reacting species within a larger time step is to use sub-stepping for the chemistry calculations. This means that within each main time step of the model, the chemical reactions are computed with much smaller time steps, allowing the model to accurately capture the dynamics of short-lived species.

4. **Parameterization and Approximation**: In some cases, the detailed dynamics of short-lived species are parameterized based on their expected effects rather than explicitly modeled. This can involve using approximations or empirical relationships that capture the net impact of these species on longer-lived constituents and overall chemical balance.

5. **Adaptive Time Stepping**: Some advanced models use adaptive time stepping, where the size of the time step is dynamically adjusted based on the rates of reaction occurring within the model. This can help in accurately capturing the effects of fast reactions without having to resort to uniformly small time steps for the entire model.

### Step 3: Addressing Numerical Stability

The problem of numerical stability in the context of short-lived atmospheric species is not ignored in air quality and weather modeling. Instead, it is addressed through a combination of sophisticated numerical techniques, approximations, and sometimes simplifications that ensure models can accurately represent the atmosphere's chemistry. While this can introduce some level of uncertainty, especially in the representation of fast chemical dynamics, model developers continuously work to improve these methods. Validation against observational data is a key part of this process, helping to ensure that models remain reliable tools for understanding and predicting atmospheric phenomena despite the inherent challenges.
```

### Metrics

```
recip_rank: 1.0000
P_1: 1.0000
P_5: 0.6000
P_10: 0.3000
P_25: 0.1200
P_50: 0.0800
P_100: 0.0400
recall_1: 0.2000
recall_5: 0.6000
recall_10: 0.6000
recall_25: 0.6000
recall_50: 0.8000
recall_100: 0.8000
ndcg_cut_1: 1.0000
ndcg_cut_5: 0.6844
ndcg_cut_10: 0.6844
ndcg_cut_25: 0.6844
ndcg_cut_50: 0.7510
ndcg_cut_100: 0.7510
map_cut_1: 0.2000
map_cut_5: 0.5200
map_cut_10: 0.5200
map_cut_25: 0.5200
map_cut_50: 0.5442
map_cut_100: 0.5442
```

## Retrieval Results

### DOC[1] (GROUND TRUTH) hydroxyl_radical_chemistry/AQCHEM_NOTES_txt2.txt
> fast ~ 1.E10 (L/mol/sec) compared to other reactions in the CMAQ aqueous<br>   mechanism, (e.g., ~1.E4 for S(IV) oxidation by H2O2). The stiffness resulting<br>   from coupling of faster and slower processes can lead to numerical<br>   instabilities in the forward Euler solver (i.e., the solver employed by<br>   aqchem.F for oxidation reactions).<br><br>   Several changes have been made to address the deficiencies in the aqueous<br>   chemistry solver. More precision was added to select variables to improve the<br>   accuracy of the calculations. Tests demonstrated that mass was not being<br>   conserved for species produced via aqueous phase oxidation reactions during<br>   the last chemistry integration step. This issue is only important

### DOC[2] (GROUND TRUTH) hydroxyl_radical_chemistry/AQCHEM_NOTES_txt4.txt
> implemented. Previously, OH reactions of glyoxal and methylglyoxal and Hg<br>   (for the multipollutant model) controlled the time step of oxidation<br>   reactions. Now only the sulfur reactions affect dt. In CMAQ’s gas phase, OH<br>   is assumed to be in pseudo-steady state, and it is not a transported species.<br>   This is because hydroxyl radical reactions tend to be catalytic (e.g.,<br>   consumption and production). In the aqueous phase chemistry, OH is absorbed<br>   by cloud water and in an open cloud model (i.e., the design approach<br>   currently employed), absorbed species (e.g., OH) would be replenished via<br>   gas-to-cloud partitioning. However, due to operator splitting, aqueous and<br>   gas-phase chemistry are not solved simultaneously. To account for this and<br>   other uncertainties in predicted OH aqueous phase concentrations (e.g.,

### DOC[3] (IRRELEVANT) meteorological_versus_astronomical_seasons/Meteorology3_33.txt
> th and 21st centuries, with the advent of computer models and big data, meteorology has become increasingly dependent on numerical methods and computer simulations. This has greatly improved weather forecasting and climate predictions. Additionally, meteorology has expanded to include other areas such as air quality, atmospheric chemistry, and climatology. The advancement in observational, theoretical and computational technologies has enabled ever more accurate weather predictions and understanding of weather pattern and air pollution. In current time, with the advancement in weather forecasting and satellite technology, meteorology has become an integral part of everyday life, and is used for many purposes such as

### DOC[4] (IRRELEVANT) ears/topo_scale1.txt
> Geosci. Model Dev., 7, 387–405, 2014<br>www.geosci-model-dev.net/7/387/2014/<br>doi:10.5194/gmd-7-387-2014<br>© Author(s) 2014. CC Attribution 3.0 License.<br>Geoscientific<br>Model Development<br>Open Access<br>TopoSCALE v.1.0: downscaling gridded climate data in<br>complex terrain<br>J. Fiddes1 and S. Gruber2<br>1Department of Geography, University of Zurich, Switzerland<br>2Department of Geography & Environmental Studies, Carleton University, Ottawa, Canada<br>Correspondence to: J. Fiddes (joel.fiddes@geo.uzh.ch)<br>Received: 26 April 2013 – Published in Geosci. Model Dev. Discuss.: 26 June 2013<br>Revised: 6 November 2013 – Accepted: 30 December 2013 – Published: 21 February 2014<br>Abstract. Simulation of land surface processes is problematic in heterogeneous terrain due to the the high resolution<br>required of model grids to capture strong lateral variability<br>caused by, for example, topography, and the lack of accurate<br>meteorological forcing data at the site or scale it is required.<br>Gridded data products produced by atmospheric models can<br>fill this gap, however, often not at an appropriate spatial resolution to drive land-surface simulations. In this study we<br>describe a method that uses the well-resolved description<br>of the atmospheric column provided by climate models, together with high-resolution digital elevation models (DEMs),<br>to downscale coarse-grid climate variables to a fine-scale<br>subgrid. The main aim of this approach is to provide highresolution driving data for a land-surface model (LSM).<br>The method makes use of an interpolation of pressurelevel data according to topographic height of the subgrid.<br>An elevation and topography correction is used to downscale short-wave radiation. Long-wave radiation is downscaled by deriving a cloud-component of all-sky emissivity<br>at grid level and using downscaled temperature and relative<br>humidity fields to describe variability with elevation. Precipitation is downscaled with a simple non-linear lapse and optionally disaggregated using a climatology approach.<br>We test the method in comparison with unscaled grid-level<br>data and a set of reference methods, against a large evaluation<br>dataset (up to 210 stations per variable) in the Swiss Alps.<br>We demonstrate that the method can be used to derive meteorological inputs in complex terrain, with most significant<br>improvements (with respect to reference methods) seen in<br>variables derived from pressure levels: air temperature, relative humidity, wind speed and incoming long-wave radiation.<br>This method may be of use in improving inputs to numerical simulations in heterogeneous and/or remote terrain, especially when statistical methods are not possible, due to lack<br>of observations (i.e. remote areas or future periods).<br>1 Introduction<br>Simulations of land-surface processes are important for performing assessments of a wide range of earth systems, under current and possible future climates. This task is problematic in complex terrain due to the inter-connected problems of (i) the high resolution required of model grids to<br>capture strong lateral variability caused by, for example, topography, surface or sub-surface processes (e.g. Gubler et al.,<br>2011; Riseborough et al., 2008; Arnold and Rees, 2009); and<br>consequently, (ii) the lack of accurate meteorological forcing data at the site or scale it is required (Thornton et al.,<br>1997; Liston and Elder, 2006). This can be due to the lack of<br>meteorological observations (i.e. spatial coverage, temporal<br>extent/continuity, or variables measured are insufficient for<br>purpose) or lack of representative observations where surface variability is high. Gridded data products produced by<br>atmospheric models can, in part, fill this gap (e.g. Frauenfeld, 2005; Pereira-Cardenal et al., 2011; Akhtar et al., 2009;<br>Vu et al., 2012); however, in many cases not at an appropriate spatial resolution to drive land-surface simulations (i.e.<br>site scale), and therefore require some form of downscaling<br>of variables.<br>Basic downscaling approaches (also referred to as disaggregation), utilise fixed relationships between the coarsegrid fields of atmospheric models and a subgrid surface,<br>Published by Copernicus Publications on behalf of the European Geosciences Union.<br>388 J. Fiddes and S. Gruber: TopoSCALE: downscaling gridded climate data in complex terrain<br>that describes a given variable at higher resolution than the<br>coarse-grid. Such approaches developed from the recognised<br>need to represent subgrid surface heterogeneity in climate<br>models and therefore the requirement to disaggregate the<br>coarse-grid climate forcing to the subgrid land-surface (e.g.<br>Dickinson et al., 1986; Wood, 1992; Koster and Suarez,<br>1992; Seth et al., 1994). For example, Giorgi et al. (2003)<br>and Dimri (2009) downscale the temperature field according<br>to the subgrid elevation and a fixed lapse rate. In a coupled<br>system it is important that the coarse-grid mean is conserved<br>by such approaches (Giorgi et al., 2003). More complex approaches to downscaling of climate data can be broadly divided into dynamical or statistical methods (Schmidli et al.,<br>2007) which are used to increase the resolution of largescale climate fields (see for full discussion Wilby and Wigley<br>(1997)). Dynamical methods achieve this by using a limited<br>area model at a higher grid resolution e.g. a regional climate model (RCM), to simulate fine-scale processes which<br>are consistent with large-scale climate fields (Giorgi, 2006).<br>While an RCM grid resolution could be increased further, in<br>practice the effective resolution is limited by the complexity<br>of the numerics that must be solved at each model time step,<br>to the order of 101 km (Kotlarski and Block, 2005). Statistical<br>methods derive empirical relationships between large-scale<br>predictor fields and local observations (Maraun and Wetterhall, 2010). These methods are computationally efficient<br>but the coverage and effective resolution is often limited by<br>the density of observations, especially in mountainous (i.e.<br>data-poor) areas. Additionally, it is unknown whether empirically derived relationships are valid outside the time window used for calibration. To compliment these approaches<br>there is a growing number of physically inspired, computationally efficient approaches that use physical relationships<br>and high-resolution surface information, that is, digital elevation models (DEMs), to distribute fine-scale forcings (meteorological stations or coarse-grid centre point) over wide<br>areas (e.g. Liston and Elder, 2006; Tarboton and Luce, 1996;<br>Marks et al., 1999; Jarosch et al., 2012). These distributed<br>forcings can then be used for full 2-D, point scale or lumped<br>model simulations.<br>Another interesting statistical approach presented by<br>Schomburg et al. (2012) utilises empirical relationships between the atmospheric coarse field and high-resolution surface data to disaggregate variables. The main aim of this<br>work was to improve the forcing of soil–vegetation transfer<br>models either in offline simulations or fully coupled model<br>systems. However, the emphasis of this work is on improving the representation of the land surface, via a distributed<br>forcing, within climate models; moreover, the scheme resolution of 400 m would be too coarse to resolve many surface<br>processes in mountain areas.<br>In complex terrain, topography-based gradients of meteorological variables (i.e. related to elevation, aspect, slope,<br>etc.) can often dominate over horizontal gradients (i.e. latitude/longitude) within a region that is of comparable size<br>to a typical coarse climate cell (e.g. 50–100 km). An example of a method that has successfully encoded this assumption is the PRISM framework (parameter–elevation regressions on independent slopes model) which provides a statistical, topography-based mapping of climate observations<br>(Daly et al., 1994, 2002). We do not neglect the fact that<br>other forms of heterogeneity may be important in modifying surface fluxes, such as surface cover, but it is important<br>to distinguish between surface heterogeneity that clearly affects atmospheric forcing, e.g. the effect of elevation on air<br>temperature, and those characteristics that become important<br>when performing a coupled land-surface–atmosphere simulation (e.g. the effect of soil properties on near-surface air<br>temperature).<br>Climate models provide spatially and temporally continuous fields which are physically consistent and therefore are<br>useful tools for forcing regional-scale land-surface studies<br>(Machguth et al., 2009; Kotlarski et al., 2010). In addition,<br>they provide a thorough description of the atmospheric column by providing data fields at many pressure levels between<br>the earth’s surface and top of the atmosphere.<br>The aim of this study is to develop methods that use<br>the well-resolved description of the atmospheric column<br>provided by climate models, together with high-resolution<br>DEMs, to downscale coarse-grid climate variables to a finescale subgrid. The main motivation of this approach is to provide high-resolution driving data for a land-surface model<br>(LSM), understood here as any process-based surface model<br>that simulates the interface of the land surface/subsurface–<br>atmosphere system. Additionally, the approach should be<br>consistent (methodologically, spatially, temporally) and not<br>reliant on observations. Therefore, the design criteria for this<br>method are (1) it provides high-resolution (< 100 m) downscaling of climate data based primarily on DEM-based information; (2) it is as physically based as possible and therefore has minimal reliance on observations and likely remains<br>valid under future conditions; (3) it employs simple methods<br>which are computationally efficient; (4) it may be used as<br>part of a modelling chain with a lumped representation of the<br>subgrid domain (e.g. Fiddes and Gruber, 2012) for large area<br>applications, as well as 1-D points and 2-D grids. Our approach therefore largely assumes vertical gradients to dominate horizontal gradients within a given model grid box. In<br>this study, we describe this method and its application with<br>ERA-Interim data, a 4-D-VAR reanalysis (3rd generation)<br>which uses the ECMWF climate model, although the method<br>could be equally used with other reanalyses (e.g. NARR,<br>NCEP/NCAR, JRA-55, NASA MERRA, or RCM derived<br>fields). Our methods are then evaluated against a large number of observations over a wide area of complex terrain in<br>the European Alps as well as compared to a set of reference<br>methods. The methods proposed here aim to provide an alternative to statistical methods when observations are not available (remote areas or future periods) and be complimentary<br>Geosci. Model Dev., 7, 387–405, 2014 www.geosci-model-dev.net/7/387/2014/<br>J. Fiddes and S. Gruber: TopoSCALE: downscaling gridded climate data in complex terrain 389<br>to dynamical methods (i.e. they could be used to further<br>downscale RCM output to site scale).<br>2 Data<br>2.1 ERA-Interim<br>ERA-I is a global atmospheric reanalysis produced by the<br>ECMWF. The ERA-Interim data assimilation system contains many improvements both in the forecasting model and<br>analysis methodology relative to ECMWF’s previous reanalysis, ERA-40, including the use of 4-dimensional variational analysis, a revised humidity analysis, the use of variational bias correction for satellite data, and other improvements in data handling (Dee et al., 2011). ERA-I provides<br>meteorological data from 1 January 1979 and continues to<br>be extended in near-real time. Gridded products include<br>a large variety of 3-hourly (00:00, 03:00, 06:00, 09:00, 12:00,<br>15:00, 18:00, and 21:00 UTC) grid-surface fields (GRID)<br>and 6-hourly (00:00, 06:00, 12:00, and 18:00 UTC) upperatmosphere products available on 60 pressure levels (PL)<br>with top of the atmosphere located at 1 mb. ERA-I relies on<br>a 4-D-VAR system which uses observations within the windows of 15:00–03:00 UTC and 03:00–15:00 UTC (in the next<br>day) to initialise forecast simulations starting at 00:00 UTC<br>and 12:00 UTC, respectively. In order to allow sufficient<br>spin-up, the first nine hours of the forecast simulations are<br>not used. All fields used in this study where extracted on the<br>ECMWF reduced Gaussian N128 grid (0.75◦ × 0.75◦<br>). Six<br>PLs are used in this study covering the range of 1000–500 mb<br>(1000, 925, 850, 775, 650, 500), corresponding to approximately an elevation range of 150–5500 m a.s.l. ERA-I fields<br>used are listed in Table 1.<br>2.2 Pressure levels below model surface<br>While ERA-I model levels are computed from the model<br>orography surface to top of the atmosphere, pressure-level<br>data is given in the interval 1000 mb (approximately sealevel)–1 mb (top of atmosphere). This means that pressurelevel data exist below the model-grid surface in regions with<br>rugged topography. The extrapolation of fields below the surface uses different methods to those above the model surface. For example, geopotential is extrapolated below the<br>model surface as a function of surface geopotential, surface temperature, temperature at mean sea level, surface<br>pressure and pressure-level value. Temperature is extrapolated below the model surface to a given pressure level as<br>a quadratic function of surface temperature, surface pressure and pressure-level value. Wind and relative humidity are<br>both constant below model surface and equal to the lowest<br>model level values (ECMWF, 2011). Additionally a greater<br>quantity of data is assimilated from above surface observations. Therefore, it can be expected that there is a difference in quality of above/below grid pressure-level data. In<br>addition, measurement locations below grid level are more<br>likely to be in valleys and therefore there will be greater exposure of observations to subgrid processes, not represented<br>by the data. See ECMWF (2011) for full details of extrapolation methods. However, it is difficult to disentangle this effect<br>from the fact that measurements above the model surface are<br>more likely to represent the free atmosphere and, therefore,<br>be more accurately simulated than those strongly effected by<br>topographic effects (e.g. Mesinger et al., 2006; Jarosch et al.,<br>2012) such as inversion layers or topographically modified<br>wind fields. This issue is addressed in the results section.<br>2.3 Evaluation data sets<br>See Table 1 for an overview (by variable) of the evaluation<br>(OBS) data sets used in this study. The MeteoSwiss automatic meteorological network (ANETZ) covers 40 stations<br>(hourly data) ranging 1132–3580 m a.s.l. and represents both<br>high mountain locations and valleys. The IMIS station network of the Swiss Institute for Snow and Avalanche Research<br>is biased towards high alpine locations (there are few valley<br>stations) but represents topographical heterogeneity in terms<br>of slope and aspect more comprehensively than ANETZ stations. Network elevation range is 1562–3341 m a.s.l. Tenminute measurements from the Alpine Surface Radiation<br>Budget network (ASRB) (Marty et al., 2002) network has<br>9 stations ranging 370–3580 m a.s.l. All OBS data sources<br>where aggregated to daily mean values to enable comparison with ERA-I fields at a common resolution. An additional<br>analysis on diurnal cycles required aggregation at 3-hourly<br>time steps. See Fig. 1 for the locations all stations used in<br>this study and elevation distribution of stations by variable.<br>See Sect. 6.1 for assimilation issues related to evaluation data<br>sets.<br>2.4 Precipitation climatology<br>The CRU Alpine precipitation data set (hereafter referred to<br>as CRU) is used as a climatology in the precipitation scheme.<br>It provides monthly precipitation totals, for the period 1800–<br>2003, gridded at 10 arc-min resolution over the Alpine region. The data set is based on 192 long-term homogenized<br>precipitation series from meteorological stations across the<br>study domain and a high-resolution precipitation climatology for the period 1971–1990. Full details are available in<br>Efthymiadis et al. (2006).<br>2.5 Data quality control<br>OBS values outside acceptable limits were removed automatically by applying physically plausible thresholds to all<br>data sets. Non-changing values beyond prescribed time limits<br>were also screened out (e.g. indicating iced wind propeller).<br>These checks follow the methods of Meek and Hatfield<br>(1994). Discontinuous data sets are valid as the testing strategy follows a point by point comparison between ERA-I<br>www.geosci-model-dev.net/7/387/2014/ Geosci. Model Dev., 7, 387–405, 2014<br>390 J. Fiddes and S. Gruber: TopoSCALE: downscaling gridded climate data in complex terrain<br>Table 1. Pressure-level and surface fields indicate variables which are computed, time steps they are obtained on from ERA-I, sources of<br>validation data (assimilated or non-assimilated), and total stations used in evaluation. Variables in section “other” are used only to support<br>calculations, and therefore columns related to validation are blank.<br>Type Variable Symbol Unit ERA-I step Assimilated Non-assimilated Total<br>(hr) sources sources stations<br>Pressure-level fields Air temperature Tpl ◦C 6 ANETZ (partial) IMIS/ASRB 210<br>Relative humidity Rhpl % 6 ANETZ (partial) IMIS/ASRB 210<br>Wind speed Wspl ms−1 6 – ANETZ/IMIS/ASRB 199<br>Surface fields Precipitation Pgrid mmh−1 3 – ANETZ/GAUGE 500<br>Short-wave radiation downwards SW↓grid Wm−2 3 – ANETZ/ASRB 27<br>Long-wave radiation downwards LW↓grid Wm−2 3 – ASRB 9<br>Other 2 m air temperature Tgrid ◦C 3 – – –<br>2 m dew point temperature Tdgrid ◦C 3 – – –<br>Top of atmosphere incident solar radiation TOA Wm−2 3 – – –<br>6 7 8 9 10<br>45.5 46.0 46.5 47.0 47.5 48.0<br>longitude<br>latitude<br>1000<br>2000<br>3000<br>4000<br>METEO IMIS ASRB<br>m asl<br>LWin<br>SWin<br>P<br>TRW<br>500 1000 1500 2000 2500 3000 3500<br>Elevation (m asl)<br>N= 9<br>N= 9<br>N= 40<br>N= 210<br>N= 9<br>N= 9<br>(a)<br>(b)<br>Fig. 1. (a) Experiment location and data sets with ERA-I grid used<br>in this study. (b) Elevation distributions of stations by variable: T ,<br>Rh, Ws (TRW, 210), P (40), SW↓ (9), LW↓ (9). The boxes are<br>drawn with widths proportional to the square-root of the number of<br>stations in the group.<br>and observations, therefore only data that exists at a given<br>time and location in both ERA-I and observations is carried through to the analysis. This ensures that the maximum possible quantity of valid data was used in the study<br>and makes error-prone gap-filling unnecessary. In aggregation we were careful to ensure that only complete data sets<br>were used in summed values and acceptable levels of datagaps (5 % threshold) were allowed in averaging procedures<br>in the interest of preserving data. No data-gaps were tolerated in summation calculations. Further details are given in<br>the text where relevant.<br>3 Methods<br>3.1 TopoSCALE<br>We downscale the variables required to drive an LSM from<br>ERA-I pressure-level (PL) and grid-surface (GRID) fields<br>(Table 1). Input pressure-level fields used are, air temperature (Tpl), relative humidity (Rhpl), wind components U and<br>V , which are converted to wind speed (Wspl). Input gridsurface fields are downwelling global radiation (SW↓grid),<br>downwelling long-wave radiation (LW↓grid) and precipitation (Pgrid). Accumulated values of SW↓grid and LW↓grid are<br>converted to time step averages of Wm−2<br>and accumulated<br>Pgrid is converted to a mean rate of mmh−1<br>, prior to scaling.<br>The temporal resolution of surface fields is 3 h and PL fields,<br>with native resolution of 6 h, are interpolated to the same 3 h<br>time step (Appendix B). Additionally, the fields Tgrid, Tdgrid<br>and SWTOA are used indirectly for radiation computations.<br>Locations at the coarse-grid level or the fine-scale subgrid<br>are referred to as GRID and SUB, respectively.<br>3.1.1 Pressure-level fields<br>Fields derived from pressure levels (Tsub, Rhsub, Wssub) are<br>computed directly from pressure-level data in two steps:<br>(1) pressure-level elevations (m a.s.l.) are estimated in a standard way by normalising geopotential heights by gravity at<br>sea level (Appendix C1). (2) Value at SUB elevation is linearly interpolated from data at pressure levels above and<br>below SUB elevation (Fig. 2). Wssub is derived from U<br>and V wind components after interpolation. Topographically<br>Geosci. Model Dev., 7, 387–405, 2014 www.geosci-model-dev.net/7/387/2014/<br>J. Fiddes and S. Gruber: TopoSCALE: downscaling gridded climate data in complex terrain 391<br>0<br>1000<br>2000<br>3000<br>4000<br>Elevation (m asl)<br>1000<br>925<br>850<br>775<br>650<br>Pressure level (mb)<br>● ●<br>T650<br>T775<br>TGRID<br>TSUB (REF) TSUB (TSCALE)<br>COARSE GRID<br>Lapse rate<br>fixed elev<br>variable elev<br>Fig. 2. Schematic of the main TopoSCALE method and experiment set up. Green line represents the coarse-grid climate data, and<br>its position in terms of elevation and pressure levels is indicated<br>with respect to topography (grey). Methods for describing a SUB<br>simulation point used in this study: (a) grid level data (TGRID),<br>(b) extrapolated grid data by reference methods (TSUB(REF)) and<br>(c) TopoSCALE interpolated pressure-level data (TSUB(TSCALE)).<br>modified wind fields can be additionally computed according<br>to a simple wind sub-model (Liston and Sturm, 1998) which<br>adjusts the speeds and directions according to topographic<br>slope and curvature relationships. To perform the wind modification calculations, the local slope, aspect, and topographic<br>curvature (a measure of relative prominence with respect to<br>surrounding terrain) are required (Appendix C2).<br>3.1.2 Radiative fluxes<br>LW↓sub is computed by deriving a cloud component of allsky emissivity at grid level and using Tsub, Rhsub to describe variability with elevation. First, clear-sky emissivity<br>at SUB (<br>cl<br>sub) and GRID (<br>cl<br>grid) are computed according to<br>Konzelmann et al. (1994):<br><br>cl<br>sub/grid = 0.23 + x1(pVsub/grid/Tsub/grid)<br>1/x2<br>, (1)<br>where x1 = 0.43 and x2 = 5.7 (Gubler et al., 2012) and water vapour pressure, pV is a function of Rh (Appendix C3).<br>The all-sky emissivity is computed at GRID using LW↓grid<br>and the Stefan–Boltzmann equation:<br><br>as<br>grid = LW ↓grid /σ T 4<br>grid, (2)<br>where σ is the Stefan–Boltzmann constant of 5.67 ×<br>10−8<br>Js−1 m−2 K<br>−4<br>. We estimate the cloud-based component of emissivity (1) at GRID though subtraction of <br>cl<br>grid<br>from <br>as<br>grid in order to apply this correction directly at SUB.<br>Finally, LW ↓sub can be computed accounting for elevation<br>changes in T and Rh by<br>LW ↓sub=<br><br><br>cl<br>sub + 1<br>σ T 4<br>sub. (3)<br>This approach assumes that cloud emissivity at GRID and<br>SUB elevations are the same, but accounts for reduction of<br>clear-sky emissivity with elevation. This is important as the<br>steepest gradients in LW↓ are often found in clear-sky conditions due to reduction in atmospheric water vapour with<br>elevation. After elevation correction, terrain effects are accounted for by reduction of LW↓sub by multiplication with<br>the sky-view factor, being the fraction of sky that is visible at<br>SUB (Vd). This assumes that LW↓ is isotropic.<br>SW↓sub is computed in a three-step process: (1) partitioning of SW↓grid into direct and diffuse components, (2) elevation adjustment of direct, and (3) topographic correction of<br>both diffuse and direct at point scale. SW↓grid can be partitioned into direct (SW↓<br>dir<br>grid) and and diffuse (SW↓<br>dif<br>grid) components according to the hourly regression model of RuizArias et al. (2010b) which has been developed based on 21<br>stations in Europe and USA (Appendix ). This method uses<br>the clearness index, which is computed by ratioing SW↓grid<br>against irradiance at top of atmosphere, SW↓toa and in doing<br>so estimates a solar transmissivity of the atmospheric column (Fig. 3a). It should be noted that the regression model<br>was developed on hourly data, whereas we apply it to 3 h<br>averages. The vertical gradient of global irradiance between<br>GRID and SUB is mainly determined by the direct component together with difference in the optical path length 1m,<br>assuming that attenuative properties of the atmosphere are<br>constant between the two elevations. Therefore, we apply an<br>elevation correction to SW↓<br>dir<br>grid only, largely following methods of Ruiz-Arias et al. (2010b) (Fig. 3b). First, 1m is computed as<br>1m = 1z cos θz, (4)<br>where 1z is difference in elevation and θz is the solar zenith<br>angle. We can then solve the Beer–Lambert law for direct<br>irradiance to obtain the broadband attenuation coefficient (k):<br>SW ↓<br>dir= SW ↓<br>toa e<br>−km, (5)<br>where m = 1/cos θz (except for large values of θz). The difference in SW↓<br>dir due to elevation difference between GRID<br>and SUB can then be found as<br>1SW ↓<br>dir<br>SW ↓dir ≈ 1 − e<br>−k1z cos θz<br>. (6)<br>Equation (6) shows direct irradiance should increase exponentially with elevation given constant k and elevation-based<br>change in irradiance is maximum when sun is at zenith and<br>zero when sun is at horizon. As the correction is only applicable to clear-sky conditions, it is applied when the air-masscorrected clearness index kt<br>is greater than 0.65 (Perez et al.,<br>1990).<br>www.geosci-model-dev.net/7/387/2014/ Geosci. Model Dev., 7, 387–405, 2014<br>392 J. Fiddes and S. Gruber: TopoSCALE: downscaling gridded climate data in complex terrain<br> θz<br>(1)<br>(2)<br> θi<br>Vd<br> θh<br> θz<br>(1)<br>ΔM θz<br>ΔZ<br>(2)<br> θz<br>(1)<br>(2)<br>(3)<br>TOP OF ATMOSPHERE (B)<br>(A)<br>(C)<br>GRID<br>SUB<br>(3)<br>Fig. 3. Solar radiation scheme. (A) SW↓ at GRID is partitioned into direct (1) and diffuse (3) components through a clearness index by<br>ratioing against extraterrestrial radiation (1). (B) An elevation correction is applied to SW↓<br>dir<br>grid (1) to obtain SW↓<br>dir<br>sub (2) based on 1z,1M<br>and θz. (C) Topographic correction is applied accounting for illumination angle, θi<br>, horizon angle, θh and sky view factor Vd.<br>SW↓<br>dir<br>sub is computed by correcting for terrain effects of slope, aspect and horizon at SUB according<br>to Dozier and Frew (1990) and Dubayah and Rich (1995)<br>(Fig. 3c). This is achieved by computing the illumination angle i, which is the angle the incident direct beam makes with<br>the slope normal and varies with solar zenith θ0 and azimuth<br>angles φ0, and local slope angle S and aspect A:<br>cosisub = cos θz cosS + sinθz sinS cos(φ0 − A). (7)<br>By ignoring variation in latitude and longitude within<br>a given grid box θz and φ0 can remain constant, which over<br>short-length scales is a reasonable simplification (e.g. Dozier<br>and Frew, 1990). As slope = 0 at GRID, cosigrid is simply<br>given by<br>cosigrid = cos θz. (8)<br>Additionally, cast-shadows and self-shadowing effects are<br>often important in complex terrain and are accounted for<br>through local horizon elevations. Wherever cosisub is negative, the point is self-shadowed, that is, the sun is below the<br>horizon formed by the local slope and SW↓<br>dir<br>sub is set to 0.<br>Cast shadows are found by horizon elevations and given as<br>δ, a binary shadow mask. Topographically corrected SW↓<br>dir<br>sub<br>is then given by first removing the GRID cosine correction<br>and then multiplying by SUB cosine correction:<br>SW ↓<br>dir<br>sub= SW ↓dir<br>cosisub<br>cosigrid<br>δ, (9)<br>where horizon elevations are either explicitly given in n directions for 1-D/2-D simulations or parameterised for use<br>ERA_I<br>SUBGRID<br>SUBGRID_LAPSE<br>50<br>100<br>150<br>200<br>250<br>mm<br>(a)<br>(b)<br>(c)<br>Fig. 4. Precipitation scheme steps: (a) ERA-I GRID precipitation,<br>(b) climatology-based subgrid spatial variability, (c) lapse-ratebased vertical variability.<br>with a lumped scheme (e.g. Fiddes and Gruber, 2012) as<br>a function of local slope and Vd in order to detect shading.<br>Computation of SW ↓<br>dif<br>sub assuming isotropy requires only<br>Vd:<br>SW ↓<br>dif<br>sub= SW ↓<br>dif<br>grid Vd. (10)<br>Geosci. Model Dev., 7, 387–405, 2014 www.geosci-model-dev.net/7/387/2014/<br>J. Fiddes and S. Gruber: TopoSCALE: downscaling gridded climate data in complex terrain 393<br>3.1.3 Precipitation<br>Precipitation patterns in mountain regions are driven by<br>a range of complex mechanisms which depend upon, for<br>example, season, geographical climate (maritime, continental) and structure of orography (Leung and Ghan, 1995;<br>Lundquist et al., 2010; Smith and Barstad, 2004). Precipitation is therefore strongly variable in both time and space.<br>Figure 4 gives an overview of the combined climatology and<br>lapse rate approach used to address this problem (e.g. Früh<br>et al., 2006). It should be noted that this routine can also be<br>implemented using only the lapse rate, in order to remove<br>any dependency on climatology data. We acknowledge that<br>the quality of the data set is heavily dependent on density of<br>observations and therefore, better than average results should<br>be expected in our study domain.<br>First, the elevation signal of the climatology data is removed by dividing by the non-linear lapse rate (λp) of Liston<br>and Elder (2006) (Appendix C5), and then normalising to<br>the GRID reference elevation. Pgrid is then disaggregated according to the subgrid variability as described by the normalised climatology (now elevation independent). Each of<br>the ith (in this study 1–25) climatology grid-cells Pclim are<br>normalised by the sum of Pclim contained in each ERA<br>course grid box, resulting in a subgrid disaggregation factor<br>Wsub,<br>Wsub = P<br>i<br>clim /<br>XPclim. (11)<br>In this study we use the CRU climatology but other sources<br>of subgrid observations could be used. Globally, or near globally available data sets (gauge and satellite based) include the<br>Tropical Rainfall Measuring Mission (Huffman et al., 2007),<br>Global Precipitation Climatology Centre (Beck et al., 2005)<br>and Climatic Research Unit (New et al., 2002) or regionally available such as PRISM (Daly et al., 1994) or even<br>direct observations if available. The product of Pgrid and<br>Wsub generates a subgrid distribution of precipitation at the<br>climatology resolution, that is conservative of the coarsegrid forcing Pgrid. Finally, λp is applied to capture fine-scale<br>precipitation-elevation gradients in order to obtain Psub,<br>Psub = Pgrid · Wsub · λp. (12)<br>It should be noted that this method simply applies a scaling<br>to the precipitation field and does not estimate the precipitation phase (snow–rain partition), this is done by the model<br>which the precipitation field is used to drive.<br>3.2 Reference methods<br>The following is a description of the reference parameterisations with which we compare the current scheme. We do not<br>intend this comparison to be exhaustive, but to merely serve<br>as a reference point, based on common parameterisations.<br>Tgrid is simply extrapolated according to a fixed lapse of<br>6.5 ◦C km−1<br>(e.g. Blandford et al., 2008). Rh is not a linear<br>function of elevation and so the relatively linear dew point<br>temperature (Td) is often used (Liston and Elder, 2006). Rh<br>can be converted to Td as a function of T and pV. In this<br>study Tdgrid is available, so this step is unnecessary.<br>Tdsub can be computed using a variable lapse rate (Kunkel,<br>1989):<br>lapse = λ · c/b, (13)<br>where λ is a vapour pressure coefficient that varies during<br>each month of the year (Kunkel, 1989) and constants b =<br>22.452, c = 272.55 ◦C are given by Buck (1981). Finally,<br>Tdsub is then converted back to Rhsub as a function of Tsub.<br>LW↓ is parameterised as a function of T and pV and cloud<br>cover according to the clear-sky formula of Konzelmann<br>et al. (1994) (Eq. 1) and the all-sky formula of Pirazzini et al.<br>(2000) while accounting for Vd,<br>LW ↓= <br>cl(1 − N<br>p1<br>) +<br><br><br>asN<br>p2<br><br>σ T 4<br>, (14)<br>where <br>cl is given by Eq. (1), N is given by the ERA-I total<br>cloud product (0–1), p1 = 6, p2 = 4 and <br>as = 0.979. Wind<br>is adjusted by 40 % per km (i.e increased above grid level<br>reduced below grid level) (Plüss, 1997). SW↓ is not compared to a reference method as the methods (i.e. partitioning,<br>elevation and topographic correction) used in this study are<br>commonly used elsewhere (i.e. Oliphant, 2003; Schroeder<br>et al., 2009). Precipitation is scaled with a non-linear lapse<br>rate (Liston and Elder, 2006).<br>4 Experiments<br>4.1 Location<br>The study region contains the entire Swiss Alps and uses 19<br>ERA-I grid boxes to cover all observations that are used to<br>evaluate the methods. Switzerland contains one of the most<br>densely observed mountain regions in the world and, therefore, is a suitable region within which to evaluate this method<br>and specifically its performance with respect to vertical information, as it covers a large elevation gradient of 195–<br>4634 m a.s.l. (Fig. 1).<br>4.2 Set-up<br>The experimental strategy is as follows: results of the current methods (TopoSCALE) are compared to (1) unscaled<br>grid level ERA-I fields (GRID) and (2) reference methods<br>(REF), where appropriate. TopoSCALE, GRID and REF are<br>all computed on 3 h time step and then aggregated to daily<br>mean values to be assessed against the OBS data sets, for the<br>period 1 January 1996–31 December 2008 (Sect. 2.3). Statistical evaluation is primarily performed using the correlation<br>coefficient (R), the root mean squared error (RMSE) and bias<br>www.geosci-model-dev.net/7/387/2014/ Geosci. Model Dev., 7, 387–405, 2014<br>394 J. Fiddes and S. Gruber: TopoSCALE: downscaling gridded climate data in complex terrain<br>Fig. 5. Observed mean daily versus modelled T , Rh, Ws and LWin for GRID, REF, and TopoSCALE methods. The representation is<br>a smoothed density plot to allow visualisation of large number plot points (IMIS-Data© 2013, SLF).<br>Geosci. Model Dev., 7, 387–405, 2014 www.geosci-model-dev.net/7/387/2014/<br>J. Fiddes and S. Gruber: TopoSCALE: downscaling gridded climate data in complex terrain 395<br>(BIAS) in order to test for systematic errors, expressed simply as<br>BIAS =<br>X(sim − obs). (15)<br>5 Results<br>In this section results are presented as follows: (1) pressurelevel-based results (T , Rh, Ws, LW↓); (2) surface-based results (SW↓ and precipitation); (3) seasonal error signatures;<br>(4) diurnal cycles; and (5) elevation effects, both absolute and<br>relative to grid level.<br>5.1 Pressure-level-based results<br>Figure 5 gives density scatter plots for the validation data set<br>(OBS) against GRID, REF and TopoSCALE results (MOD)<br>of variables computed based on pressure-level data (with exception of SW↓). A density plot is used because of the large<br>number of points plotted (e.g. ∼ 106<br>in the case of T ).<br>For T , (210 stations), TopoSCALE gives a significant<br>improvement in R, RMSE and BIAS of T with respect<br>to observations. Applying a fixed lapse rate (REF) improves the RMSE by 0.75 ◦C over grid level values whereas<br>TopoSCALE improves RMSE by 2.66 ◦C. The BIAS in REF<br>(1.5) is similar to GRID (1.62), whereas TopoSCALE significantly improves this (−0.02). Bias in TopoSCALE is concentrated at extremes of temperature (i.e. low temperatures<br>are too high and high temperatures are too low).<br>For Rh (210 stations), TopoSCALE gives a significant improvement in the correlation and modest improvement in<br>RMSE (due to the poorly performing cluster at high humidity). There appears to be a high degree of uncertainty in saturated conditions (i.e. measurements at or close to 100 %) in<br>all cases. TopoSCALE shows significant improvement over<br>GRID and REF (approximately the same performance) particular in the interval 0–60 % which is significant for processes such as sublimation which occur in dry atmospheric<br>conditions. Both GRID and REF seem unable to represent<br>humidities less than 30 %. This could possibly be that dry<br>(often well below 30% humidity) Foehn winds are represented in the pressure-level data but absent from surface data.<br>Several discontinuities were observed in the wind time series that are possibly related to changing patterns of data<br>assimilation (Fig. 7a). At least one of these artefacts fits<br>to a major data introduction (European wind profilers in<br>2002). Therefore, the wind analysis was restricted to a three<br>year period (1996–1998) that was stable. Comparison of<br>distributions of wind speed show a large improvement of<br>TopoSCALE over GRID especially in the R value and BIAS.<br>There is still a large degree of scatter especially at high wind<br>speeds. The most significant result is an improvement in<br>BIAS with a shift of the distribution to the 1 : 1 line, while<br>the GRID data is not able to represent values greater than<br>5 ms−1<br>.<br>●<br>● ●<br>●<br>●<br>●●<br>●<br>●<br>● ● ●<br>●<br>●<br>●<br>●<br>●<br>●<br>● ●<br>●<br>●<br>●<br>● ●<br>●<br>●<br>●<br>●<br>●<br>●<br>●<br>●<br>● ●<br>●<br>●<br>●<br>●<br>●<br>●

### DOC[5] (GROUND TRUTH) hydroxyl_radical_chemistry/AQCHEM_NOTES_txt1.txt
> AQCHEM_NOTES - 13 January 2010<br><br>Solver Stability<br><br>   Several problems in the aqueous chemistry routine were uncovered in the<br>   application of the CMAQv4.7 multipollutant model.  In some instances,<br>   sporadic abnormally high sulfate concentrations were simulated (400 ug/m3);<br>   in general, the noted abnormalities were episodic and variable. The aqueous<br>   chemistry subroutine in the multipollutant model includes new reactions with<br>   the hydroxyl radical to convert mercury (Hg) covalence states and to produce<br>   “cloud SOA” (Carlton et al., (2008)). These reaction rate constants are very<br>   fast ~ 1.E10 (L/mol/sec) compared to other reactions in the CMAQ aqueous


## Ground Truth

### GROUND TRUTH 0, ranked 32, hydroxyl_radical_chemistry/AQCHEM_NOTES_txt3.txt
> episodically, when the maximum number of iterations (100) in the solver is<br>   reached (in which case the timestep for the final iteration is expanded to<br>   the remainder of the cloud lifetime. A design change was implemented so that<br>   now, after reaching 100 iterations, the solver will continue to integrate<br>   using a minimum 1 second timestep for the remainder of the cloud lifetime.<br>   Mass is conserved in the later part of the cloud lifetime, as total mass<br>   available is a limit for the oxidized amount. With this change, the mass<br>   conservation problems were eliminated.<br><br>   Considering that the aqueous chemistry routine was designed to predict<br>   sulfate and not stiff OH-reacting mechanisms, a further design change was

### GROUND TRUTH 1, ranked 1, hydroxyl_radical_chemistry/AQCHEM_NOTES_txt4.txt
> implemented. Previously, OH reactions of glyoxal and methylglyoxal and Hg<br>   (for the multipollutant model) controlled the time step of oxidation<br>   reactions. Now only the sulfur reactions affect dt. In CMAQ’s gas phase, OH<br>   is assumed to be in pseudo-steady state, and it is not a transported species.<br>   This is because hydroxyl radical reactions tend to be catalytic (e.g.,<br>   consumption and production). In the aqueous phase chemistry, OH is absorbed<br>   by cloud water and in an open cloud model (i.e., the design approach<br>   currently employed), absorbed species (e.g., OH) would be replenished via<br>   gas-to-cloud partitioning. However, due to operator splitting, aqueous and<br>   gas-phase chemistry are not solved simultaneously. To account for this and<br>   other uncertainties in predicted OH aqueous phase concentrations (e.g.,

### GROUND TRUTH 2, ranked 4, hydroxyl_radical_chemistry/AQCHEM_NOTES_txt1.txt
> AQCHEM_NOTES - 13 January 2010<br><br>Solver Stability<br><br>   Several problems in the aqueous chemistry routine were uncovered in the<br>   application of the CMAQv4.7 multipollutant model.  In some instances,<br>   sporadic abnormally high sulfate concentrations were simulated (400 ug/m3);<br>   in general, the noted abnormalities were episodic and variable. The aqueous<br>   chemistry subroutine in the multipollutant model includes new reactions with<br>   the hydroxyl radical to convert mercury (Hg) covalence states and to produce<br>   “cloud SOA” (Carlton et al., (2008)). These reaction rate constants are very<br>   fast ~ 1.E10 (L/mol/sec) compared to other reactions in the CMAQ aqueous

### GROUND TRUTH 3, ranked 0, hydroxyl_radical_chemistry/AQCHEM_NOTES_txt2.txt
> fast ~ 1.E10 (L/mol/sec) compared to other reactions in the CMAQ aqueous<br>   mechanism, (e.g., ~1.E4 for S(IV) oxidation by H2O2). The stiffness resulting<br>   from coupling of faster and slower processes can lead to numerical<br>   instabilities in the forward Euler solver (i.e., the solver employed by<br>   aqchem.F for oxidation reactions).<br><br>   Several changes have been made to address the deficiencies in the aqueous<br>   chemistry solver. More precision was added to select variables to improve the<br>   accuracy of the calculations. Tests demonstrated that mass was not being<br>   conserved for species produced via aqueous phase oxidation reactions during<br>   the last chemistry integration step. This issue is only important

### GROUND TRUTH 4, ranked not in top 100, hydroxyl_radical_chemistry/AQCHEM_NOTES_txt5.txt
> neglect of production reactions (H2O2 + hv - 2 OH) not currently implemented<br>   in aqchem), a steady-state assumption for OH is adopted in the aqueous<br>   chemistry routine.<br><br>   References:<br><br>    Carlton, A.G., B.J. Turpin, K.E. Altieri, S.P. Seitzinger, R. Mathur,<br>       S.J. Roselle, and R.J. Weber, CMAQ Model Performance Enhanced When<br>       In-Cloud Secondary Organic Aerosol is Included:  Comparison of Organic<br>       Carbon Predictions with Measurements, Environ. Sci. Technol., 42(23),<br>       8798-8802, 2008.
